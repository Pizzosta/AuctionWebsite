{% extends "base.html" %}{% block title %}Admin{% endblock %}
{% block content %}
<div class="container-fluid mb-3">
    <h4 class="text-center m-2">Welcome, <strong>{{ username }}!</strong></h4>
</div>
<!--<form method="POST" enctype="multipart/form-data">
    <div class="mb-3">
        <label for="image">Upload Image:</label>
        <input type="file" id="image" name="image" accept="image/*" multiple>
    </div>
    <div id="image-preview">
        <!-- Preview thumbnails will appear here 
    </div>
    <button type="button" class="btn btn-danger" id="clear-thumbnails">Reset</button>
    <button type="submit" class="btn btn-primary">Upload Image</button>
</form>-->
<!-- Auction Model -->

<!--<form method="POST" action="{{ url_for('views.admin_panel') }}" enctype="multipart/form-data">
    <h2>Auction Information</h2>

    <label for="title">Auction Title:</label>
    <input type="text" id="title" name="title" required><br>
    <label for="description">Description:</label>
    <textarea id="description" name="description" required></textarea><br>
    <label for="start_time">Start Time:</label>
    <input type="datetime-local" id="start_time" name="start_time" required><br>
    <label for="end_time">End Time:</label>
    <input type="datetime-local" id="end_time" name="end_time" required><br>
    <label for="starting_bid">Starting Bid:</label>
    <input type="number" step="0.01" id="starting_bid" name="starting_bid" required><br>

    <h2>Bid Information</h2>

    <label for="amount">Bid Amount:</label>
    <input type="number" step="0.01" id="amount" name="amount" placeholder="Bid Amount"><br>

    <h2>Image Information</h2>

    <label for="image">Upload Image:</label>
    <input type="file" id="image" name="image" accept="image/*" multiple required>
    <div id="image-preview">
        <-- Preview thumbnails will appear here ->
    </div>
    <button type="submit">Submit</button>

</form>-->

<form method="POST" action="{{ url_for('views.admin_panel') }}" enctype="multipart/form-data" class="needs-validation">
    <h2>Auction Information</h2>

    <div class="form-group col-md-6">
        <label for="title">Auction Title:</label>
        <input type="text" id="title" name="title" class="form-control" required>
    </div>

    <div class="form-group col-md-6">
        <label for="description">Description:</label>
        <textarea id="description" name="description" class="form-control" rows="5" required></textarea>
    </div>

    <div class="form-row">
        <div class="form-group col-md-4">
            <label for="start_time">Start Time:</label>
            <input type="datetime-local" id="start_time" name="start_time" class="form-control"
                min="{{ current_datetime() | datetime_local_format }}" required>
        </div>
        <div class="form-group col-md-4">
            <label for="end_time">End Time:</label>
            <input type="datetime-local" id="end_time" name="end_time" class="form-control"
                min="{{ current_datetime() | datetime_local_format }}" required>
        </div>
    </div>

    <div class="form-group col-md-2">
        <label for="starting_bid">Starting Bid:</label>
        <input type="number" step="0.01" id="starting_bid" name="starting_bid" class="form-control" required>
    </div>

    <h2>Bid Information</h2>

    <div class="form-group col-md-2">
        <label for="amount">Bid Amount:</label>
        <input type="number" step="0.01" id="amount" name="amount" class="form-control" placeholder="Bid Amount">
    </div>

    <h2>Image Information</h2>

    <div class="form-group">
        <label for="image">Upload Image:</label>
        <input type="file" id="image" name="image" accept="image/*" class="form-control-file" multiple required>
        <div id="image-preview" class="mt-2">
            <!-- Preview thumbnails will appear here -->
        </div>
    </div>
    <div id="image-preview" class="mt-2">
        <!-- Preview thumbnails will appear here -->
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
</form>


<div>
    <h2>All Bids</h2>
    <ol>
        {% for bid in all_bids %}
        <li>
            Auction ID: {{ bid.auction_id }}<br>
            Amount: {{ bid.amount }}<br>
        </li>
        {% endfor %}
    </ol>
</div>


<div>
    <h5 class="text-center">ALL AUCTIONS IN THE DATABASE</h5>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Creator</th>
                <th>Title</th>
                <th>Description</th>
                <th>Created At</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Starting Bid</th>
                <th>Highest Bid</th>
                <th>Delete Auction</th>
            </tr>
        </thead>
        <tbody>
            {% for auction in all_auctions %}

            <tr id="auction-row-{{ auction.id }}">
                <td>{{ auction.user.username }}</td>
                <td>{{ auction.title }}</td>
                <td>{{ auction.description }}</td>
                <td>{{ auction.created_at }}</td>
                <td>{{ auction.start_time }}</td>
                <td>{{ auction.end_time }}</td>
                <td>{{ auction.starting_bid }}</td>
                <td>
                    {% if highest_bids[auction.id] is not none %}
                    {{ '%.2f' | format(highest_bids[auction.id]) }}
                    {% else %}
                    No bids yet
                    {% endif %}
                </td>
                <td> <button type="button" class="btn btn-danger"
                        onclick="deleteAuction({{ auction.id }})">Delete</button>
                </td>
                <!--<td><a href="/delete-auction/{{ auction.id }}" class="btn btn-danger">Delete</a></td>-->
            </tr>

            {% endfor %}
        </tbody>
    </table>
</div>

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    {% if all_auctions.has_prev %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('views.admin_panel', page=all_auctions.prev_num) }}"
                            aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    {% endif %}
                    {% for page_num in all_auctions.iter_pages() %}
                    {% if page_num %}
                    <li class="page-item {% if page_num == all_auctions.page %}active{% endif %}">
                        <a class="page-link" href="{{ url_for('views.admin_panel', page=page_num) }}">{{
                            page_num
                            }}</a>
                    </li>
                    {% else %}
                    <li class="page-item">
                        <span class="page-link">...</span>
                    </li>
                    {% endif %}
                    {% endfor %}
                    {% if all_auctions.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('views.admin_panel', page=all_auctions.next_num) }}"
                            aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </div>
</div>

{% endblock %}